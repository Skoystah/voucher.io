# voucher.io

A web application to retrieve and manage available parking vouchers for Leuven.

## Features

- Retrieve a list of parking vouchers usable for SMS parking in Leuven
- Filter vouchers by duration and usage
- Mark vouchers as used so they will no longer be retrieved 
- Web interface for easy voucher lookup and management using a REST API
- CLI interface for admin access
- Add vouchers in bulk via a csv file (under development)

## Context

I have created this application as a learning project to get in touch with various
subjects in development. This explains some architectural decisions, that might seem 
overkill for an application this small (e.g. Alembic database migrations, distributed Turso database, ...).
My goal was to create a full end-to-end application, including continuous integration and deployment, 
and some bells and whistles. 

Subjects that I have learned about:

 - **Python** : Created a full OOP CRUD application.
 - **JavaScript** : Basic Javascript to provide interaction between frontend and my REST API
 - **ORM** : Integration of SQL Alchemy and Mapped classes to represent my data.
 - **HTML/CSS** : Creating a basic web page with basic layout to display and manage my data.
 - **TDD** : Using TDD for a large part of my development in order to have good working Unit tests for the whole scope.
 - **CI/CD** : A basic workflow using GitHub Actions with automated unit tests (unittest), formatting (ruff) and deployment to Google Cloud
 - **Docker** : The application is deployed as a Docker image to Google Cloud. 
 - **Google Cloud** : Deploying the application on Google Cloud automatically from GitHub (push not pull)
 - **HTTP server** : Creating an HTTP server from scratch using the Python bare http.server library. 
 This is not useable in production but provides a more in depth learning experience. 
 - **FastAPI** : Implementation of FastAPI to replace HTTP Server (HTTP server still available in separate branch) and simplify the code. 

What I still want to explore further:

- **More HTML/CSS** : Further polish my frontend part to have a basic yet good looking and user friendly page.
- **Security** : Add an authentication layer, so only selected users may manage vouchers. Optionally
extend this system to a limited set of other users.
- **Features** : Add more features to the application (e.g. add vouchers, remove vouchers, ...), which are now
only accessible through the Command Line Interface.
- **Python tools** : Explore other Python tools (e.g. PyTest, MyPy, FastAPI or Flask)
    - FastAPI has been implemented. 

---

## Table of Contents

- [Overview](#overview)
- [Getting Started](#getting-started)
- [Python REST API](#python-rest-api)
  - [API Endpoints](#api-endpoints)
- [Web App (JavaScript)](#web-app-javascript)
- [Development](#development)
- [License](#license)

---

## Overview

**voucher.io** consists of:
- A Python-based REST API backend for managing parking vouchers in Leuven.
- A JavaScript-based web application frontend for searching and using vouchers.

---

## Getting Started

### Requirements

- Python 3.10+

### Install & Run (locally)

1. **Clone the repository:**

   ```sh
   git clone https://github.com/Skoystah/voucher.io.git
   cd voucher.io
   ```

2. **Install Python dependencies:**

   ```sh
   uv sync --locked --all-extras
   ```

3. **Run the server:**

   ```sh
   cd src
   uv run main.py
   ```

   _By default, the API is available at `http://localhost:8000`._

4. **Open the web app:**

   Simply open `app/index.html` in your browser. It will connect to the backend API.

---

## Python REST API

The backend REST API provides endpoints to manage and query parking vouchers.
For documentation see also `/docs` in the application when deployed (automatically generated by FastAPI)

### API Endpoints

| Method | Endpoint                     | Description                                 | Example Body / Query          |
|--------|------------------------------|---------------------------------------------|-------------------------------|
| GET    | `/vouchers`                  | List all vouchers                           | `?duration=1h&includeUsed=false` |
| POST   | `/vouchers`                  | Add a new voucher                           | `{"code": "LEU123", "duration": "1h"}` |
| PUT    | `/vouchers/{code}`           | Mark voucher as used                        | None                          |
| DELETE | `/vouchers/{code}`           | Delete voucher                              | None                          |

#### Request & Response Examples

- **GET /vouchers**

  Returns a list of vouchers. Optional query parameters:
    - `duration`: Filter by duration, possible values in (`1h`, `2h`, `4h`, `12h`)
    - `includeUsed`: Include vouchers that have already been used (`true` or `false`). If absent, only unused vouchers are retrieved.

  Example response:

  ```json
  [
    {
      "code": "LEU123",
      "duration": "1h",
      "used": false
    },
    {
      "code": "LEU456",
      "duration": "2h",
      "used": true
    }
  ]
  ```

- **POST /vouchers**

  Add a new voucher. 
  Mandatory values:
    - `code`: Format LEUxxxxxxxxx
    - `duration`: One of these values: `1h`, `2h`, `4h`, `12h`
  Voucher is created by default as unused (`used = false`)

  Request Body:

  ```json
  {
    "code": "LEU789",
    "duration": "4h"
  }
  ```

  Response:

  ```json
  {
    "code": "LEU789",
    "duration": "4h",
    "used": false
  }
  ```

- **PUT /vouchers/{code}**

  Mark a voucher as used.

  On success: HTTP 200 OK.

- **DELETE /vouchers/{code}**

  Delete a voucher from database.

  On success: HTTP 200 OK.

#### CORS

CORS headers are enabled for all API endpoints.

---

## Web App (JavaScript)

The frontend is a simple JavaScript single-page app found in `/app`:

- **index.html**: Main HTML page.
- **scripts/main.js**: Contains logic to fetch vouchers from the API, filter results, and mark vouchers as used.
- **css/style.css**: Basic styling.

### Usage

- Open `app/index.html` in your browser.
- Use the form to search for vouchers (by duration, or include used).
- Click "Use voucher" to mark a voucher as used.

#### Example JavaScript usage

The frontend interacts with the REST API using `fetch`, e.g.:

```javascript
// Fetch vouchers
fetch('http://localhost:8000/vouchers?duration=1h')
  .then(res => res.json())
  .then(data => presentVouchers(data));

// Use a voucher
fetch('http://localhost:8000/vouchers/LEU123', { method: 'PUT' });
```

---

## Development

- Python server source code is in `/src`.
  - Entry point: `src/main.py`
  - REST API logic: `src/web/handler/voucher.py`
  - Voucher DB logic: `src/voucher/db.py`
- Frontend source is in `/app`.
  - HTML: `app/index.html`
  - JS: `app/scripts/main.js`
  - CSS: `app/css/style.css`
- Tests in `/tests`.

---

## License

Currently no license. Please contact the repository owner if you wish to use this code.

---

## Author

[Skoystah](https://github.com/Skoystah)

